import{_ as q}from"./AppSelect.vue_vue_type_script_setup_true_lang-BMtFneVg.js";import{_ as J}from"./AppTextField.vue_vue_type_script_setup_true_lang-DPq5q084.js";import{c as m}from"./common-api.web.min-CNoIadEv.js";import{d as K}from"./PriceUtil-gve-ZJJ4.js";import{a as Q,d as W}from"./Http-D0rxl0mN.js";import{L as ee}from"./LocationSettingService-BEkbILhW.js";import{V as S,a as r}from"./VRow-Bfn2e2d6.js";import{d as te,r as w,X as $,G as ae,aj as le,c as M,b as l,e as i,f as o,m as p,ai as g,o as f,t as c,$ as oe,F as se,i as ne,g as O,l as I,v as n}from"./index-C4u4uETL.js";import{V as ie}from"./VCard-BGEKklbS.js";import{V as re}from"./VCardText-DvY-xX5u.js";import{V as de}from"./VSpacer-CA2bIuLQ.js";import{V as z}from"./VSwitch-DZt-L0n1.js";import{V as _}from"./VRangeSlider-Cr0BN9xc.js";const me={class:"d-flex align-center justify-space-between"},ce={class:"d-flex align-center justify-space-between mb-4"},ue={class:"text-caption mb-1"},pe={class:"text-caption mb-1"},fe={class:"text-caption mb-1"},_e={class:"text-caption mb-1"},be={class:"text-caption mb-1"},Ve={class:"pt-5 text-right"},T=20,U=1e3,x=1e3,A=-60,L=-12,Ee=te({__name:"setting-group",emits:["done"],setup(he,{emit:P}){var D;const G=P,H=((D=Q().getCurrentAccount)==null?void 0:D.currency)??m.Api.HubriseCurrencyCode.EUR,F=W(),k=w(!1),d=w([]),j=[{title:"Delivery",value:m.Api.HubriseServiceType.DELIVERY},{title:"Pickup",value:m.Api.HubriseServiceType.COLLECTION},{title:"Eat-In",value:m.Api.HubriseServiceType.EAT_IN}],V=new ee("smsmode_customer_groups",k,e=>{}),E=e=>{d.value.length<20&&d.value.push({id:Date.now(),name:e,useZipCodes:!1,zipCodes:void 0,orderCountRange:[0,T],totalSpentRange:[0,U],loyaltyPointsRange:[0,x],firstOrderDateRange:[A,0],lastOrderDateRange:[L,0],serviceTypes:[m.Api.HubriseServiceType.DELIVERY,m.Api.HubriseServiceType.COLLECTION,m.Api.HubriseServiceType.EAT_IN],smsOptIn:!0})},B=e=>{d.value.length>1&&(d.value=d.value.filter(s=>s.id!==e))},Y=(e,s)=>!e||e.trim().length===0?"Group name is required":e.trim()!==e?"Group name cannot have leading or trailing spaces":/^[a-z0-9\-]+$/i.test(e)?d.value.find(b=>b.id!==s&&b.name.toLowerCase()===e.toLowerCase())?"A group with this name already exists":!0:"Only letters, numbers and dashes are allowed",N=$(()=>{const e={};return d.value.forEach(s=>{const u=Y(s.name,s.id);u!==!0&&(e[s.id]=u)}),e}),X=$(()=>Object.keys(N.value).length===0),h=e=>e===T?`${e}+`:`${e}`,y=e=>e===x?`${e}+`:`${e}`,R=e=>`${K(m.Api.HubrisePriceUtil.amountToPrice(e,H),!0,!0)}${e===U?"+":""}`,v=e=>e===0?"Now":`${Math.abs(e)}${e===A?"+":""} month${Math.abs(e)>1?"s":""} ago`,C=e=>e===0?"Now":`${Math.abs(e)}${e===L?"+":""} month${Math.abs(e)>1?"s":""} ago`,Z=()=>{V.saveSetting({}),G("done",{})};return ae(()=>{var e;V.start(),E(m.Util.StringUtil.slugify(((e=F.getCurrentLocation)==null?void 0:e.name)??"all"))}),le(()=>{V.stop()}),(e,s)=>{const u=J,b=q;return f(),M("div",null,[l(S,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[i("div",me,[s[2]||(s[2]=i("div",null,[i("h6",{class:"text-h6 font-weight-medium"}," Customer Groups "),i("p",{class:"mb-0"}," Manage your customer groups for smsmode ")],-1)),l(g,{disabled:p(d).length>=10,color:"primary",variant:"tonal",onClick:s[0]||(s[0]=t=>E(""))},{default:o(()=>[l(oe,{icon:"bx-plus",start:""}),s[1]||(s[1]=c(" Add Group "))]),_:1,__:[1]},8,["disabled"])])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(S,null,{default:o(()=>[(f(!0),M(se,null,ne(p(d),t=>(f(),O(r,{key:t.id,cols:"12"},{default:o(()=>[l(ie,{variant:"outlined"},{default:o(()=>[l(re,null,{default:o(()=>[i("div",ce,[l(u,{modelValue:t.name,"onUpdate:modelValue":a=>t.name=a,"error-messages":p(N)[t.id]||"",density:"compact",label:"Group Name"},null,8,["modelValue","onUpdate:modelValue","error-messages"]),l(de),p(d).length>1?(f(),O(g,{key:0,color:"error",icon:"bx-trash",size:"small",variant:"text",onClick:a=>B(t.id)},null,8,["onClick"])):I("",!0)]),l(S,null,{default:o(()=>[l(r,{cols:"12",md:"4"},{default:o(()=>[s[3]||(s[3]=i("div",{class:"text-caption"}," Marketing opt-in ",-1)),l(z,{modelValue:t.smsOptIn,"onUpdate:modelValue":a=>t.smsOptIn=a,density:"compact","hide-details":"",label:"SMS marketing"},null,8,["modelValue","onUpdate:modelValue"])]),_:2,__:[3]},1024),l(r,{cols:"12",md:"4"},{default:o(()=>[i("div",ue," Order count: "+n(h(t.orderCountRange[0]))+" - "+n(h(t.orderCountRange[1])),1),l(_,{modelValue:t.orderCountRange,"onUpdate:modelValue":a=>t.orderCountRange=a,max:T,min:0,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(h(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{cols:"12",md:"4"},{default:o(()=>[i("div",pe," Total spent: "+n(R(t.totalSpentRange[0]))+" - "+n(R(t.totalSpentRange[1])),1),l(_,{modelValue:t.totalSpentRange,"onUpdate:modelValue":a=>t.totalSpentRange=a,max:U,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(R(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{cols:"12",md:"4"},{default:o(()=>[i("div",fe," Loyalty points: "+n(y(t.loyaltyPointsRange[0]))+" - "+n(y(t.loyaltyPointsRange[1])),1),l(_,{modelValue:t.loyaltyPointsRange,"onUpdate:modelValue":a=>t.loyaltyPointsRange=a,max:x,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(y(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{cols:"12",md:"4"},{default:o(()=>[i("div",_e," First order: "+n(v(t.firstOrderDateRange[0]))+" - "+n(v(t.firstOrderDateRange[1])),1),l(_,{modelValue:t.firstOrderDateRange,"onUpdate:modelValue":a=>t.firstOrderDateRange=a,max:0,min:A,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(v(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{cols:"12",md:"4"},{default:o(()=>[i("div",be," Last order: "+n(C(t.lastOrderDateRange[0]))+" - "+n(C(t.lastOrderDateRange[1])),1),l(_,{modelValue:t.lastOrderDateRange,"onUpdate:modelValue":a=>t.lastOrderDateRange=a,max:0,min:L,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(C(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{cols:"12",md:"5"},{default:o(()=>[l(b,{modelValue:t.serviceTypes,"onUpdate:modelValue":a=>t.serviceTypes=a,items:j,chips:"","closable-chips":"",label:"Select service type",multiple:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(r,{class:"d-inline-flex align-items-center justify-space-between gap-4 align-center",cols:"12",md:"7"},{default:o(()=>[l(z,{modelValue:t.useZipCodes,"onUpdate:modelValue":a=>t.useZipCodes=a,class:"d-inline-block align-baseline",density:"compact","hide-details":"",label:"Restrict by zip codes"},null,8,["modelValue","onUpdate:modelValue"]),t.useZipCodes?(f(),O(u,{key:0,modelValue:t.zipCodes,"onUpdate:modelValue":a=>t.zipCodes=a,class:"d-inline-block align-baseline",density:"compact",label:"zip codes (comma separated)",placeholder:"75001,75002,75003"},null,8,["modelValue","onUpdate:modelValue"])):I("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),i("div",Ve,[l(g,{disabled:!p(X),loading:p(k),onClick:Z},{default:o(()=>s[4]||(s[4]=[c(" Save ")])),_:1,__:[4]},8,["disabled","loading"])])])}}});export{Ee as _};
