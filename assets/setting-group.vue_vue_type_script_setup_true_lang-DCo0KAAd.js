import{_ as J}from"./AppSelect.vue_vue_type_script_setup_true_lang-Bjs9RlT-.js";import{_ as K}from"./AppTextField.vue_vue_type_script_setup_true_lang-CJ0d7_Re.js";import{c as m}from"./common-api.web.min-CArMEcVz.js";import{d as Q}from"./PriceUtil-CbumP6Pj.js";import{a as W,d as Z}from"./Http-CDqqPxIa.js";import{L as ee}from"./LocationSettingService-ChtbFPpx.js";import{V as S,a as d}from"./VRow-D8SRbiPb.js";import{d as te,r as D,X as $,G as ae,aj as le,c as w,b as l,e as r,f as o,m as p,ai as C,o as f,t as c,$ as oe,F as se,i as ne,g as O,l as z,v as n}from"./index-DqY9bX1y.js";import{V as ie}from"./VCard-Byo8u5ae.js";import{V as re}from"./VCardText-1wk3mYgs.js";import{V as de}from"./VSpacer-CRT0ueuP.js";import{V as I}from"./VSwitch-fXSSkyKQ.js";import{V as _}from"./VRangeSlider-D-q0StVN.js";const me={class:"d-flex align-center justify-space-between"},ce={class:"d-flex align-center justify-space-between mb-4"},ue={class:"text-caption mb-1"},pe={class:"text-caption mb-1"},fe={class:"text-caption mb-1"},_e={class:"text-caption mb-1"},be={class:"text-caption mb-1"},Ve={class:"pt-5 text-right"},T=20,x=1e3,A=1e3,U=-60,k=-12,Ee=te({__name:"setting-group",emits:["done"],setup(he,{emit:P}){var N;const G=P,H=((N=W().getCurrentAccount)==null?void 0:N.currency)??m.Api.HubriseCurrencyCode.EUR,F=Z(),L=D(!1),i=D([]),j=[{title:"Delivery",value:m.Api.HubriseServiceType.DELIVERY},{title:"Pickup",value:m.Api.HubriseServiceType.COLLECTION},{title:"Eat-In",value:m.Api.HubriseServiceType.EAT_IN}],V=new ee("smsmode_customer_groups",L,e=>{var s;Array.isArray(e.setting.groups)?i.value=e.setting.groups:E(m.Util.StringUtil.slugify(((s=F.getCurrentLocation)==null?void 0:s.name)??"all"))}),E=e=>{i.value.length<20&&i.value.push({id:String(Date.now()),name:e,zipCodes:void 0,orderCountRange:[0,T],totalSpentRange:[0,x],loyaltyPointsRange:[0,A],firstOrderDateRange:[U,0],lastOrderDateRange:[k,0],lastOrderServiceTypes:[m.Api.HubriseServiceType.DELIVERY,m.Api.HubriseServiceType.COLLECTION,m.Api.HubriseServiceType.EAT_IN],smsMarketingOptIn:!0})},B=e=>{i.value.length>1&&(i.value=i.value.filter(s=>s.id!==e))},Y=(e,s)=>!e||e.trim().length===0?"Group name is required":e.trim()!==e?"Group name cannot have leading or trailing spaces":/^[a-z0-9\-]+$/i.test(e)?i.value.find(b=>b.id!==s&&b.name.toLowerCase()===e.toLowerCase())?"A group with this name already exists":!0:"Only letters, numbers and dashes are allowed",M=$(()=>{const e={};return i.value.forEach(s=>{const u=Y(s.name,s.id);u!==!0&&(e[s.id]=u)}),e}),X=$(()=>Object.keys(M.value).length===0),h=e=>e===T?`${e}+`:`${e}`,y=e=>e===A?`${e}+`:`${e}`,v=e=>`${Q(m.Api.HubrisePriceUtil.amountToPrice(e,H),!0,!0)}${e===x?"+":""}`,g=e=>e===0?"Now":`${Math.abs(e)}${e===U?"+":""} month${Math.abs(e)>1?"s":""} ago`,R=e=>e===0?"Now":`${Math.abs(e)}${e===k?"+":""} month${Math.abs(e)>1?"s":""} ago`,q=()=>{V.saveSetting({groups:i.value}).then(()=>G("done"))};return ae(()=>{V.start()}),le(()=>{V.stop()}),(e,s)=>{const u=K,b=J;return f(),w("div",null,[l(S,null,{default:o(()=>[l(d,{cols:"12"},{default:o(()=>[r("div",me,[s[2]||(s[2]=r("div",null,[r("h6",{class:"text-h6 font-weight-medium"}," Customer Groups "),r("p",{class:"mb-0"}," Manage your customer groups for smsmode ")],-1)),l(C,{disabled:p(i).length>=10,color:"primary",variant:"tonal",onClick:s[0]||(s[0]=t=>E(""))},{default:o(()=>[l(oe,{icon:"bx-plus",start:""}),s[1]||(s[1]=c(" Add Group "))]),_:1,__:[1]},8,["disabled"])])]),_:1}),l(d,{cols:"12"},{default:o(()=>[l(S,null,{default:o(()=>[(f(!0),w(se,null,ne(p(i),t=>(f(),O(d,{key:t.id,cols:"12"},{default:o(()=>[l(ie,{variant:"outlined"},{default:o(()=>[l(re,null,{default:o(()=>[r("div",ce,[l(u,{modelValue:t.name,"onUpdate:modelValue":a=>t.name=a,"error-messages":p(M)[t.id]||"",density:"compact",label:"Group Name"},null,8,["modelValue","onUpdate:modelValue","error-messages"]),l(de),p(i).length>1?(f(),O(C,{key:0,color:"error",icon:"bx-trash",size:"small",variant:"text",onClick:a=>B(t.id)},null,8,["onClick"])):z("",!0)]),l(S,null,{default:o(()=>[l(d,{cols:"12",md:"4"},{default:o(()=>[s[3]||(s[3]=r("div",{class:"text-caption"}," Marketing opt-in ",-1)),l(I,{modelValue:t.smsMarketingOptIn,"onUpdate:modelValue":a=>t.smsMarketingOptIn=a,density:"compact","hide-details":"",label:"SMS marketing"},null,8,["modelValue","onUpdate:modelValue"])]),_:2,__:[3]},1024),l(d,{cols:"12",md:"4"},{default:o(()=>[r("div",ue," Order count: "+n(h(t.orderCountRange[0]))+" - "+n(h(t.orderCountRange[1])),1),l(_,{modelValue:t.orderCountRange,"onUpdate:modelValue":a=>t.orderCountRange=a,max:T,min:0,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(h(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{cols:"12",md:"4"},{default:o(()=>[r("div",pe," Total spent: "+n(v(t.totalSpentRange[0]))+" - "+n(v(t.totalSpentRange[1])),1),l(_,{modelValue:t.totalSpentRange,"onUpdate:modelValue":a=>t.totalSpentRange=a,max:x,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(v(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{cols:"12",md:"4"},{default:o(()=>[r("div",fe," Loyalty points: "+n(y(t.loyaltyPointsRange[0]))+" - "+n(y(t.loyaltyPointsRange[1])),1),l(_,{modelValue:t.loyaltyPointsRange,"onUpdate:modelValue":a=>t.loyaltyPointsRange=a,max:A,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(y(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{cols:"12",md:"4"},{default:o(()=>[r("div",_e," First order: "+n(g(t.firstOrderDateRange[0]))+" - "+n(g(t.firstOrderDateRange[1])),1),l(_,{modelValue:t.firstOrderDateRange,"onUpdate:modelValue":a=>t.firstOrderDateRange=a,max:0,min:U,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(g(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{cols:"12",md:"4"},{default:o(()=>[r("div",be," Last order: "+n(R(t.lastOrderDateRange[0]))+" - "+n(R(t.lastOrderDateRange[1])),1),l(_,{modelValue:t.lastOrderDateRange,"onUpdate:modelValue":a=>t.lastOrderDateRange=a,max:0,min:k,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":o(({modelValue:a})=>[c(n(R(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{cols:"12",md:"5"},{default:o(()=>[l(b,{modelValue:t.lastOrderServiceTypes,"onUpdate:modelValue":a=>t.lastOrderServiceTypes=a,items:j,chips:"","closable-chips":"",label:"Select service type from the last order",multiple:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(d,{class:"d-inline-flex align-items-center justify-space-between gap-4 align-center",cols:"12",md:"7"},{default:o(()=>[l(I,{class:"d-inline-block align-baseline",density:"compact","hide-details":"",label:"Restrict by zip codes",onClick:a=>t.zipCodes=t.zipCodes===void 0?"":void 0},null,8,["onClick"]),t.zipCodes!==void 0?(f(),O(u,{key:0,modelValue:t.zipCodes,"onUpdate:modelValue":a=>t.zipCodes=a,class:"d-inline-block align-baseline",density:"compact",label:"zip codes (comma separated)",placeholder:"75001,75002,75003"},null,8,["modelValue","onUpdate:modelValue"])):z("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),r("div",Ve,[l(C,{disabled:!p(X),loading:p(L),onClick:q},{default:o(()=>s[4]||(s[4]=[c(" Save ")])),_:1,__:[4]},8,["disabled","loading"])])])}}});export{Ee as _};
